{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ASUS\\\\Documents\\\\htm_fe\\\\src\\\\routes\\\\ProtectedRoute.tsx\";\nimport React, { useState, useEffect } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport axios from 'axios';\n\n// Define the expected response from /api/auth/verify\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n// Modal component for access denied\nconst AccessDeniedModal = ({\n  onClose,\n  message\n}) => {\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm z-50\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"bg-slate-800/90 border border-red-400/50 rounded-xl p-8 shadow-2xl max-w-md w-full mx-4\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-center\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"text-4xl mb-4\",\n          children: \"\\uD83D\\uDEAB\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 23,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n          className: \"text-2xl font-semibold text-white mb-4\",\n          children: \"Access Denied\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 24,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-red-200/70 mb-6\",\n          children: message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 25,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: onClose,\n          className: \"bg-gradient-to-r from-red-600 to-orange-600 text-white px-6 py-3 rounded-lg hover:from-red-700 hover:to-orange-700 font-medium transition-colors duration-300 shadow-lg hover:shadow-red-600/30\",\n          children: \"Go Back\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 26,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 22,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 21,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 20,\n    columnNumber: 9\n  }, this);\n};\n\n// Route-to-role mapping\n_c = AccessDeniedModal;\nconst routeRoleMap = {\n  '/host': 'host',\n  '/play': 'player',\n  '/spectator': 'spectator'\n};\n\n// HOC for role-based access control\nconst withRoleCheck = WrappedComponent => {\n  var _s = $RefreshSig$();\n  const ComponentWithRoleCheck = props => {\n    _s();\n    const [showModal, setShowModal] = useState(false);\n    const [modalMessage, setModalMessage] = useState('You don\\'t have the right role to access this route.');\n    const location = useLocation();\n    const navigate = useNavigate();\n    useEffect(() => {\n      const verifyRole = async () => {\n        // Get access token from localStorage (set in SetupMatch)\n        const accessToken = localStorage.getItem('accessToken');\n        if (!accessToken) {\n          setModalMessage('No access token found. Please log in.');\n          setShowModal(true);\n          return;\n        }\n        try {\n          // Send token to /api/auth/verify\n          const response = await axios.post(`http://localhost:8000/api/auth/verify`, {}, {\n            headers: {\n              'Content-Type': 'application/json',\n              'Authorization': `Bearer ${accessToken}`\n            }\n          });\n          const payload = response.data;\n          if (!payload) {\n            setModalMessage('Invalid token payload.');\n            setShowModal(true);\n            return;\n          }\n\n          // Get the required role for the current route\n          const requiredRole = routeRoleMap[location.pathname];\n\n          // Check if the user's role matches the required role\n          if (!requiredRole || payload.role !== requiredRole) {\n            setModalMessage('You don\\'t have the right role to access this route.');\n            setShowModal(true);\n            return;\n          }\n\n          // Check token expiration (optional, if backend doesn't handle it)\n          const currentTime = Date.now() / 1000;\n          if (payload.exp < currentTime) {\n            setModalMessage('Your session has expired. Please log in again.');\n            setShowModal(true);\n            return;\n          }\n        } catch (error) {\n          console.error('Error verifying access token:', error);\n          setModalMessage('Failed to verify access token. Please try again.');\n          setShowModal(true);\n        }\n      };\n      verifyRole();\n    }, [location.pathname]);\n    const handleCloseModal = () => {\n      setShowModal(false);\n      navigate(-1); // Go back to previous page\n    };\n    if (showModal) {\n      return /*#__PURE__*/_jsxDEV(AccessDeniedModal, {\n        onClose: handleCloseModal,\n        message: modalMessage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 20\n      }, this);\n    }\n    return /*#__PURE__*/_jsxDEV(WrappedComponent, {\n      ...props\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 16\n    }, this);\n  };\n  _s(ComponentWithRoleCheck, \"yz1iYMgt0q+WVM+b2ZKdP+s1Kmk=\", false, function () {\n    return [useLocation, useNavigate];\n  });\n  return ComponentWithRoleCheck;\n};\nexport default withRoleCheck;\nvar _c;\n$RefreshReg$(_c, \"AccessDeniedModal\");","map":{"version":3,"names":["React","useState","useEffect","useLocation","useNavigate","axios","jsxDEV","_jsxDEV","AccessDeniedModal","onClose","message","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","_c","routeRoleMap","withRoleCheck","WrappedComponent","_s","$RefreshSig$","ComponentWithRoleCheck","props","showModal","setShowModal","modalMessage","setModalMessage","location","navigate","verifyRole","accessToken","localStorage","getItem","response","post","headers","payload","data","requiredRole","pathname","role","currentTime","Date","now","exp","error","console","handleCloseModal","$RefreshReg$"],"sources":["C:/Users/ASUS/Documents/htm_fe/src/routes/ProtectedRoute.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport axios from 'axios';\r\n\r\n// Define the expected response from /api/auth/verify\r\ninterface VerifyResponse {\r\n    success: boolean;\r\n    payload?: {\r\n        roomId: string;\r\n        role: 'host' | 'player' | 'spectator';\r\n        userId: string;\r\n        exp: number;\r\n    };\r\n    message?: string;\r\n}\r\n\r\n// Modal component for access denied\r\nconst AccessDeniedModal: React.FC<{ onClose: () => void; message: string }> = ({ onClose, message }) => {\r\n    return (\r\n        <div className=\"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm z-50\">\r\n            <div className=\"bg-slate-800/90 border border-red-400/50 rounded-xl p-8 shadow-2xl max-w-md w-full mx-4\">\r\n                <div className=\"text-center\">\r\n                    <div className=\"text-4xl mb-4\">ðŸš«</div>\r\n                    <h3 className=\"text-2xl font-semibold text-white mb-4\">Access Denied</h3>\r\n                    <p className=\"text-red-200/70 mb-6\">{message}</p>\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"bg-gradient-to-r from-red-600 to-orange-600 text-white px-6 py-3 rounded-lg hover:from-red-700 hover:to-orange-700 font-medium transition-colors duration-300 shadow-lg hover:shadow-red-600/30\"\r\n                    >\r\n                        Go Back\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\n// Route-to-role mapping\r\nconst routeRoleMap: { [key: string]: 'host' | 'player' | 'spectator' } = {\r\n    '/host': 'host',\r\n    '/play': 'player',\r\n    '/spectator': 'spectator',\r\n};\r\n\r\n// HOC for role-based access control\r\nconst withRoleCheck = <P extends object>(WrappedComponent: React.ComponentType<P>) => {\r\n    const ComponentWithRoleCheck: React.FC<P> = (props) => {\r\n        const [showModal, setShowModal] = useState(false);\r\n        const [modalMessage, setModalMessage] = useState('You don\\'t have the right role to access this route.');\r\n        const location = useLocation();\r\n        const navigate = useNavigate();\r\n\r\n        useEffect(() => {\r\n            const verifyRole = async () => {\r\n                // Get access token from localStorage (set in SetupMatch)\r\n                const accessToken = localStorage.getItem('accessToken');\r\n\r\n                if (!accessToken) {\r\n                    setModalMessage('No access token found. Please log in.');\r\n                    setShowModal(true);\r\n                    return;\r\n                }\r\n\r\n                try {\r\n                    // Send token to /api/auth/verify\r\n                    const response = await axios.post(`http://localhost:8000/api/auth/verify`, {}, {\r\n                        headers: {\r\n                            'Content-Type': 'application/json',\r\n                            'Authorization': `Bearer ${accessToken}`\r\n                        },\r\n                    });\r\n\r\n                    const payload = response.data;\r\n\r\n                    if (!payload) {\r\n                        setModalMessage('Invalid token payload.');\r\n                        setShowModal(true);\r\n                        return;\r\n                    }\r\n\r\n                    // Get the required role for the current route\r\n                    const requiredRole = routeRoleMap[location.pathname];\r\n\r\n                    // Check if the user's role matches the required role\r\n                    if (!requiredRole || payload.role !== requiredRole) {\r\n                        setModalMessage('You don\\'t have the right role to access this route.');\r\n                        setShowModal(true);\r\n                        return;\r\n                    }\r\n\r\n                    // Check token expiration (optional, if backend doesn't handle it)\r\n                    const currentTime = Date.now() / 1000;\r\n                    if (payload.exp < currentTime) {\r\n                        setModalMessage('Your session has expired. Please log in again.');\r\n                        setShowModal(true);\r\n                        return;\r\n                    }\r\n                } catch (error) {\r\n                    console.error('Error verifying access token:', error);\r\n                    setModalMessage('Failed to verify access token. Please try again.');\r\n                    setShowModal(true);\r\n                }\r\n            };\r\n\r\n            verifyRole();\r\n        }, [location.pathname]);\r\n\r\n        const handleCloseModal = () => {\r\n            setShowModal(false);\r\n            navigate(-1); // Go back to previous page\r\n        };\r\n\r\n        if (showModal) {\r\n            return <AccessDeniedModal onClose={handleCloseModal} message={modalMessage} />;\r\n        }\r\n\r\n        return <WrappedComponent {...props} />;\r\n    };\r\n\r\n    return ComponentWithRoleCheck;\r\n};\r\n\r\nexport default withRoleCheck;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}