{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ASUS\\\\Documents\\\\htm_fe\\\\src\\\\components\\\\PlayerScore.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useLayoutEffect, useRef } from 'react';\nimport { usePlayer } from '../context/playerContext';\nimport { listenToScores } from '../services/firebaseServices';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction PlayerScore() {\n  _s();\n  const {\n    roomId,\n    scoreList,\n    setScoreList,\n    setPlayerFlashes\n  } = usePlayer();\n  const prevOrder = useRef({});\n  const nodesRef = useRef({});\n\n  // Save previous order BEFORE scoreList updates\n  useLayoutEffect(() => {\n    const order = {};\n    scoreList.forEach((p, i) => order[p.playerName] = i);\n    prevOrder.current = order;\n  }, [scoreList]);\n  useEffect(() => {\n    const unsubscribePlayers = listenToScores(roomId, scoreList => {\n      if (Array.isArray(scoreList)) {\n        const scoreListWithFlashes = scoreList.map(score => ({\n          ...score,\n          flashColor: score.isModified ? score.isCorrect ? \"flash-correct\" : \"flash-incorrect\" : null,\n          isModified: score.isModified\n        }));\n        setPlayerFlashes(scoreListWithFlashes);\n        const sortedList = [...scoreList].sort((a, b) => parseInt(b.score) - parseInt(a.score));\n        setScoreList(sortedList);\n      }\n    });\n    return () => {\n      unsubscribePlayers();\n    };\n  }, [roomId, setPlayerFlashes, setScoreList]);\n\n  // FLIP animation\n  useLayoutEffect(() => {\n    scoreList.forEach((player, index) => {\n      const node = nodesRef.current[player.playerName];\n      if (!node) return;\n      const prevIndex = prevOrder.current[player.playerName];\n      if (prevIndex === undefined || prevIndex === index) return;\n      const deltaY = (prevIndex - index) * 60;\n      node.style.transition = 'none';\n      node.style.transform = `translateY(${deltaY}px)`;\n      // Force reflow\n      node.getBoundingClientRect();\n      node.style.transition = 'transform 1.8s cubic-bezier(.22,1,.36,1), box-shadow 0.3s';\n      node.style.transform = `translateY(0)`;\n    });\n  }, [scoreList]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bg-white mt-4 p-4 rounded-lg shadow-md flex-1 relative overflow-hidden\",\n    style: {\n      height: `${scoreList.length * 60}px`,\n      minHeight: 120\n    },\n    children: [scoreList.map((player, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: el => {\n        nodesRef.current[player.playerName] = el;\n      },\n      className: `player-item absolute w-[95%] left-[2.5%] flex items-center bg-white rounded-lg shadow-md mb-2 px-3 py-2\n                        ${player.flashColor ? player.flashColor : \"\"}\n                    `,\n      style: {\n        top: `${index * 60}px`,\n        boxShadow: player.flashColor ? player.flashColor === \"flash-correct\" ? \"0 0 16px 2px #4ade80\" : \"0 0 16px 2px #f87171\" : \"0 1px 6px rgba(0,0,0,0.08)\",\n        background: \"#fff\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"img\", {\n        src: player.avatar,\n        alt: player.playerName,\n        className: \"w-8 h-8 rounded-full mr-2\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex-1\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-sm font-semibold\",\n          children: player.playerName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 80,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"w-full bg-gray-200 text-center py-1 rounded-lg font-mono\",\n          children: `Score: ${player.score}`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 81,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 21\n      }, this)]\n    }, player.playerName, true, {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 17\n    }, this)), /*#__PURE__*/_jsxDEV(\"style\", {\n      children: `\n                .flash-correct { animation: flashGreen 0.5s; }\n                .flash-incorrect { animation: flashRed 0.5s; }\n                @keyframes flashGreen {\n                  0% { background: #bbf7d0; }\n                  100% { background: #fff; }\n                }\n                @keyframes flashRed {\n                  0% { background: #fecaca; }\n                  100% { background: #fff; }\n                }\n            `\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 54,\n    columnNumber: 9\n  }, this);\n}\n_s(PlayerScore, \"Cc2rMVpaNaPXNzGqaHjUnicc30w=\", false, function () {\n  return [usePlayer];\n});\n_c = PlayerScore;\nexport default PlayerScore;\nvar _c;\n$RefreshReg$(_c, \"PlayerScore\");","map":{"version":3,"names":["React","useEffect","useLayoutEffect","useRef","usePlayer","listenToScores","jsxDEV","_jsxDEV","PlayerScore","_s","roomId","scoreList","setScoreList","setPlayerFlashes","prevOrder","nodesRef","order","forEach","p","i","playerName","current","unsubscribePlayers","Array","isArray","scoreListWithFlashes","map","score","flashColor","isModified","isCorrect","sortedList","sort","a","b","parseInt","player","index","node","prevIndex","undefined","deltaY","style","transition","transform","getBoundingClientRect","className","height","length","minHeight","children","ref","el","top","boxShadow","background","src","avatar","alt","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/ASUS/Documents/htm_fe/src/components/PlayerScore.tsx"],"sourcesContent":["import React, { useEffect, useLayoutEffect, useRef } from 'react';\r\nimport { Score } from '../type';\r\nimport { usePlayer } from '../context/playerContext';\r\nimport { listenToScores } from '../services/firebaseServices';\r\n\r\nfunction PlayerScore() {\r\n    const { roomId, scoreList, setScoreList, setPlayerFlashes } = usePlayer();\r\n    const prevOrder = useRef<{ [name: string]: number }>({});\r\n    const nodesRef = useRef<{ [name: string]: HTMLDivElement | null }>({});\r\n\r\n    // Save previous order BEFORE scoreList updates\r\n    useLayoutEffect(() => {\r\n        const order: { [name: string]: number } = {};\r\n        scoreList.forEach((p: Score, i: number) => (order[p.playerName] = i));\r\n        prevOrder.current = order;\r\n    }, [scoreList]);\r\n\r\n    useEffect(() => {\r\n        const unsubscribePlayers = listenToScores(roomId, (scoreList) => {\r\n            if (Array.isArray(scoreList)) {\r\n                const scoreListWithFlashes = scoreList.map((score: Score) => ({\r\n                    ...score,\r\n                    flashColor: score.isModified ? score.isCorrect ? \"flash-correct\" : \"flash-incorrect\" : null,\r\n                    isModified: score.isModified\r\n                }));\r\n                setPlayerFlashes(scoreListWithFlashes);\r\n                const sortedList = [...scoreList].sort((a, b) => parseInt(b.score) - parseInt(a.score));\r\n                setScoreList(sortedList);\r\n            }\r\n        });\r\n        return () => {\r\n            unsubscribePlayers();\r\n        };\r\n    }, [roomId, setPlayerFlashes, setScoreList]);\r\n\r\n    // FLIP animation\r\n    useLayoutEffect(() => {\r\n        scoreList.forEach((player: Score, index: number) => {\r\n            const node = nodesRef.current[player.playerName];\r\n            if (!node) return;\r\n            const prevIndex = prevOrder.current[player.playerName];\r\n            if (prevIndex === undefined || prevIndex === index) return;\r\n            const deltaY = (prevIndex - index) * 60;\r\n            node.style.transition = 'none';\r\n            node.style.transform = `translateY(${deltaY}px)`;\r\n            // Force reflow\r\n            node.getBoundingClientRect();\r\n            node.style.transition = 'transform 1.8s cubic-bezier(.22,1,.36,1), box-shadow 0.3s';\r\n            node.style.transform = `translateY(0)`;\r\n        });\r\n    }, [scoreList]);\r\n\r\n    return (\r\n        <div\r\n            className=\"bg-white mt-4 p-4 rounded-lg shadow-md flex-1 relative overflow-hidden\"\r\n            style={{ height: `${scoreList.length * 60}px`, minHeight: 120 }}\r\n        >\r\n            {scoreList.map((player: Score, index: number) => (\r\n                <div\r\n                    key={player.playerName}\r\n                    ref={el => { nodesRef.current[player.playerName] = el; }} className={`player-item absolute w-[95%] left-[2.5%] flex items-center bg-white rounded-lg shadow-md mb-2 px-3 py-2\r\n                        ${player.flashColor ? player.flashColor : \"\"}\r\n                    `}\r\n                    style={{\r\n                        top: `${index * 60}px`,\r\n                        boxShadow: player.flashColor\r\n                            ? player.flashColor === \"flash-correct\"\r\n                                ? \"0 0 16px 2px #4ade80\"\r\n                                : \"0 0 16px 2px #f87171\"\r\n                            : \"0 1px 6px rgba(0,0,0,0.08)\",\r\n                        background: \"#fff\",\r\n                    }}\r\n                >\r\n                    <img\r\n                        src={player.avatar}\r\n                        alt={player.playerName}\r\n                        className=\"w-8 h-8 rounded-full mr-2\"\r\n                    />\r\n                    <div className=\"flex-1\">\r\n                        <p className=\"text-sm font-semibold\">{player.playerName}</p>\r\n                        <div className=\"w-full bg-gray-200 text-center py-1 rounded-lg font-mono\">\r\n                            {`Score: ${player.score}`}\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            ))}\r\n            <style>{`\r\n                .flash-correct { animation: flashGreen 0.5s; }\r\n                .flash-incorrect { animation: flashRed 0.5s; }\r\n                @keyframes flashGreen {\r\n                  0% { background: #bbf7d0; }\r\n                  100% { background: #fff; }\r\n                }\r\n                @keyframes flashRed {\r\n                  0% { background: #fecaca; }\r\n                  100% { background: #fff; }\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default PlayerScore;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}