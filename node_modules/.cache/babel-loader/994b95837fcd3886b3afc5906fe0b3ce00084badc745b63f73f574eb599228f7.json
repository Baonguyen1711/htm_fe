{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ASUS\\\\Documents\\\\htm_fe\\\\src\\\\routes\\\\ProtectedRoute.tsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { useLocation, useNavigate } from 'react-router-dom';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst routeRoleMap = {\n  '/host': 'host',\n  '/play': 'player',\n  '/spectator': 'spectator'\n};\nconst AccessDeniedModal = ({\n  onClose,\n  message\n}) => /*#__PURE__*/_jsxDEV(\"div\", {\n  className: \"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm z-50\",\n  children: /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"bg-slate-800/90 border border-red-400/50 rounded-xl p-8 shadow-2xl max-w-md w-full mx-4\",\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-center\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-4xl mb-4\",\n        children: \"\\uD83D\\uDEAB\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 26,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n        className: \"text-2xl font-semibold text-white mb-4\",\n        children: \"Access Denied\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 27,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"text-red-200/70 mb-6\",\n        children: message\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 28,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: onClose,\n        className: \"bg-gradient-to-r from-red-600 to-orange-600 text-white px-6 py-3 rounded-lg hover:from-red-700 hover:to-orange-700 font-medium transition-colors duration-300 shadow-lg hover:shadow-red-600/30\",\n        children: \"Go Back\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 29,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 25,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 24,\n    columnNumber: 9\n  }, this)\n}, void 0, false, {\n  fileName: _jsxFileName,\n  lineNumber: 23,\n  columnNumber: 5\n}, this);\n_c = AccessDeniedModal;\nconst ProtectedRoute = ({\n  element\n}) => {\n  _s();\n  const [showModal, setShowModal] = useState(false);\n  const [modalMessage, setModalMessage] = useState(\"You don't have the right role to access this route.\");\n  const [isVerified, setIsVerified] = useState(false);\n  const location = useLocation();\n  const navigate = useNavigate();\n  useEffect(() => {\n    const verifyRole = async () => {\n      const accessToken = localStorage.getItem('accessToken');\n      if (!accessToken) {\n        setModalMessage('No access token found. Please log in.');\n        setShowModal(true);\n        return;\n      }\n      try {\n        const response = await axios.post(`http://localhost:8000/api/auth/verify`, {}, {\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${accessToken}`\n          }\n        });\n        const payload = response.data;\n        if (!payload) {\n          setModalMessage('Invalid token payload.');\n          setShowModal(true);\n          return;\n        }\n        const requiredRole = routeRoleMap[`/${location.pathname.split('/')[1]}`];\n        if (!requiredRole || payload !== requiredRole) {\n          setModalMessage('You don\\'t have the right role to access this route.');\n          setShowModal(true);\n          return;\n        }\n        const currentTime = Date.now() / 1000;\n        if (payload.exp < currentTime) {\n          setModalMessage('Your session has expired. Please log in again.');\n          setShowModal(true);\n          return;\n        }\n        setIsVerified(true);\n      } catch (error) {\n        console.error('Error verifying access token:', error);\n        setModalMessage('Failed to verify access token. Please try again.');\n        setShowModal(true);\n      }\n    };\n    verifyRole();\n  }, [location.pathname]);\n  const handleCloseModal = () => {\n    setShowModal(false);\n    navigate(-1);\n  };\n  if (showModal) {\n    return /*#__PURE__*/_jsxDEV(AccessDeniedModal, {\n      onClose: handleCloseModal,\n      message: modalMessage\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 16\n    }, this);\n  }\n  if (!isVerified) {\n    return null; // Or return a loading spinner\n  }\n  return element;\n};\n_s(ProtectedRoute, \"rA0y/Zn9JGfGxNmBaIW7ZcJgsR0=\", false, function () {\n  return [useLocation, useNavigate];\n});\n_c2 = ProtectedRoute;\nexport default ProtectedRoute;\nvar _c, _c2;\n$RefreshReg$(_c, \"AccessDeniedModal\");\n$RefreshReg$(_c2, \"ProtectedRoute\");","map":{"version":3,"names":["React","useEffect","useState","useLocation","useNavigate","axios","jsxDEV","_jsxDEV","routeRoleMap","AccessDeniedModal","onClose","message","className","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","_c","ProtectedRoute","element","_s","showModal","setShowModal","modalMessage","setModalMessage","isVerified","setIsVerified","location","navigate","verifyRole","accessToken","localStorage","getItem","response","post","headers","payload","data","requiredRole","pathname","split","currentTime","Date","now","exp","error","console","handleCloseModal","_c2","$RefreshReg$"],"sources":["C:/Users/ASUS/Documents/htm_fe/src/routes/ProtectedRoute.tsx"],"sourcesContent":["import React, { ReactNode, useEffect, useState } from 'react';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport axios from 'axios';\r\n\r\ninterface VerifyResponse {\r\n    success: boolean;\r\n    payload?: {\r\n        roomId: string;\r\n        role: 'host' | 'player' | 'spectator';\r\n        userId: string;\r\n        exp: number;\r\n    };\r\n    message?: string;\r\n}\r\n\r\nconst routeRoleMap: { [key: string]: 'host' | 'player' | 'spectator' } = {\r\n    '/host': 'host',\r\n    '/play': 'player',\r\n    '/spectator': 'spectator',\r\n};\r\n\r\nconst AccessDeniedModal: React.FC<{ onClose: () => void; message: string }> = ({ onClose, message }) => (\r\n    <div className=\"fixed inset-0 flex items-center justify-center bg-black/50 backdrop-blur-sm z-50\">\r\n        <div className=\"bg-slate-800/90 border border-red-400/50 rounded-xl p-8 shadow-2xl max-w-md w-full mx-4\">\r\n            <div className=\"text-center\">\r\n                <div className=\"text-4xl mb-4\">ðŸš«</div>\r\n                <h3 className=\"text-2xl font-semibold text-white mb-4\">Access Denied</h3>\r\n                <p className=\"text-red-200/70 mb-6\">{message}</p>\r\n                <button\r\n                    onClick={onClose}\r\n                    className=\"bg-gradient-to-r from-red-600 to-orange-600 text-white px-6 py-3 rounded-lg hover:from-red-700 hover:to-orange-700 font-medium transition-colors duration-300 shadow-lg hover:shadow-red-600/30\"\r\n                >\r\n                    Go Back\r\n                </button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n);\r\n\r\nconst ProtectedRoute: React.FC<{ element: ReactNode }> = ({ element }) => {\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [modalMessage, setModalMessage] = useState(\"You don't have the right role to access this route.\");\r\n    const [isVerified, setIsVerified] = useState(false);\r\n\r\n    const location = useLocation();\r\n    const navigate = useNavigate();\r\n\r\n    useEffect(() => {\r\n        const verifyRole = async () => {\r\n            const accessToken = localStorage.getItem('accessToken');\r\n            if (!accessToken) {\r\n                setModalMessage('No access token found. Please log in.');\r\n                setShowModal(true);\r\n                return;\r\n            }\r\n\r\n            try {\r\n                const response = await axios.post<VerifyResponse>(\r\n                    `http://localhost:8000/api/auth/verify`,\r\n                    {},\r\n                    {\r\n                        headers: {\r\n                            'Content-Type': 'application/json',\r\n                            'Authorization': `Bearer ${accessToken}`,\r\n                        },\r\n                    }\r\n                );\r\n\r\n                const payload = response.data;\r\n                if (!payload) {\r\n                    setModalMessage('Invalid token payload.');\r\n                    setShowModal(true);\r\n                    return;\r\n                }\r\n\r\n                const requiredRole = routeRoleMap[`/${location.pathname.split('/')[1]}`];\r\n\r\n                if (!requiredRole || payload !== requiredRole) {\r\n                    setModalMessage('You don\\'t have the right role to access this route.');\r\n                    setShowModal(true);\r\n                    return;\r\n                }\r\n\r\n                const currentTime = Date.now() / 1000;\r\n                if (payload.exp < currentTime) {\r\n                    setModalMessage('Your session has expired. Please log in again.');\r\n                    setShowModal(true);\r\n                    return;\r\n                }\r\n\r\n                setIsVerified(true);\r\n            } catch (error) {\r\n                console.error('Error verifying access token:', error);\r\n                setModalMessage('Failed to verify access token. Please try again.');\r\n                setShowModal(true);\r\n            }\r\n        };\r\n\r\n        verifyRole();\r\n    }, [location.pathname]);\r\n\r\n    const handleCloseModal = () => {\r\n        setShowModal(false);\r\n        navigate(-1);\r\n    };\r\n\r\n    if (showModal) {\r\n        return <AccessDeniedModal onClose={handleCloseModal} message={modalMessage} />;\r\n    }\r\n\r\n    if (!isVerified) {\r\n        return null; // Or return a loading spinner\r\n    }\r\n\r\n    return element;\r\n};\r\n\r\nexport default ProtectedRoute;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}