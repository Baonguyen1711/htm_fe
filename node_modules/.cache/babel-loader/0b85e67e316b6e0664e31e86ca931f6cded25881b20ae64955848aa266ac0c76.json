{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\ASUS\\\\Documents\\\\htm_fe\\\\src\\\\layouts\\\\RoundBase\\\\Round2.tsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { usePlayer } from \"../../context/playerContext\";\nimport { setSelectedRow, setCorrectRow, setIncorectRow } from \"../../components/services\";\nimport { deletePath, listenToTimeStart, listenToBuzzing, listenToSound, listenToCorrectRow, listenToIncorrectRow, listenToSelectRow, listenToQuestions, listenToObstacle } from \"../../services/firebaseServices\";\nimport { useSearchParams } from \"react-router-dom\";\nimport { getNextQuestion } from \"../../pages/Host/Test/service\";\nimport { openObstacle } from \"../../components/services\";\nimport { generateGrid } from \"../../pages/User/Round2/utils\";\nimport PlayerAnswerInput from \"../../components/ui/PlayerAnswerInput\";\nimport { useSounds } from \"../../context/soundContext\";\nimport { resetBuzz } from \"../../components/services\";\nimport { useTimeStart } from \"../../context/timeListenerContext\";\nimport { submitAnswer } from \"../services\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n;\nconst mainKeyword = \"BÒCÔNGANH\";\nconst QuestionBoxRound2 = ({\n  obstacleWord,\n  hintWordArray,\n  initialGrid,\n  isSpectator = false,\n  isHost = false\n}) => {\n  _s();\n  var _grid$;\n  console.log(\"initialGrid inside player\", initialGrid);\n  const {\n    startTimer,\n    timeLeft,\n    setTimeLeft\n  } = useTimeStart();\n  const sounds = useSounds();\n  const [searchParams] = useSearchParams();\n  const {\n    setInitialGrid,\n    animationKey,\n    setAnimationKey,\n    playerAnswerRef,\n    position,\n    setAnswerList\n  } = usePlayer();\n  const [numberPositions, setNumberPositions] = useState([]);\n  const roomId = searchParams.get(\"roomId\") || \"\";\n  const testName = searchParams.get(\"testName\") || \"\";\n  const GRID_SIZE = 30;\n  const [grid, setGrid] = useState([[]]);\n  const [hintWords, setHintWords] = useState([]);\n  const [currentQuestion, setCurrentQuestion] = useState();\n  const [buzzedPlayer, setBuzzedPlayer] = useState(\"\");\n  const [cellStyles, setCellStyles] = useState({}); // Tracks background and text styles\n  const [menu, setMenu] = useState({\n    visible: false\n  });\n  const [hintWordsLength, setHintWordsLength] = useState([]);\n  const [markedCharacters, setMarkedCharacters] = useState({});\n  const [highlightedCharacters, setHighlightedCharacters] = useState({});\n  const [showModal, setShowModal] = useState(false);\n  const isInitialTimerMount = useRef(false);\n  useEffect(() => {\n    console.log(\"timeLeft\", timeLeft);\n    if (isInitialTimerMount.current) {\n      isInitialTimerMount.current = false;\n      return;\n    }\n    if (timeLeft === 0) {\n      submitAnswer(roomId, playerAnswerRef.current, position);\n      setAnimationKey(prev => prev + 1);\n\n      // If you want to reset timer, call startTimer again here or leave stopped\n    }\n  }, [timeLeft]);\n  const isInitialMount = useRef(false);\n  useEffect(() => {\n    const unsubscribe = listenToTimeStart(roomId, async () => {\n      // Skip the timer setting on the first mount, but allow future calls to run\n      if (isInitialMount.current) {\n        isInitialMount.current = false;\n        return;\n      }\n      startTimer(15);\n      return () => {\n        unsubscribe();\n      };\n    });\n  }, []);\n  const handleSuffleGrid = async () => {\n    if (isHost && hintWordArray) {\n      const result = await generateGrid(hintWordArray, 30);\n      console.log(\"board\", result.grid);\n      let topBound = 0;\n      let bottomBound = 0;\n      setHintWords(result.placementArray);\n      setGrid(result.grid);\n      const numberPositionArray = [];\n      result.grid.map((row, rowIndex) => row.map((cell, colIndex) => {\n        if (result.grid[rowIndex][colIndex].includes(\"number\")) {\n          numberPositionArray.push({\n            rowIndex: rowIndex,\n            colIndex: colIndex,\n            index: result.grid[rowIndex][colIndex].replace(\"number\", \"\")\n          });\n        }\n      }));\n      const blankGrid = result.grid.map((row, rowIndex) => row.map((cell, colIndex) => result.grid[rowIndex][colIndex].includes(\"number\") ? cell :\n      // Keep \"numberX\"\n      cell !== \" \" && cell !== \"\" ? \"1\" : \"\" // Non-empty to \"1\", empty stays \"\"\n      ));\n      setInitialGrid(blankGrid);\n    }\n  };\n\n  // const isInitialMount = true;\n  // useEffect(() => {\n  //       if (isInitialMount) return\n\n  //       // Start timer when selectedTopic changes\n  //       startTimer(15);\n\n  //       return () => {  \n\n  //       }\n\n  //       // Side effects based on timer reaching 0\n  //   }, []);\n\n  const handleCloseModal = () => {\n    setShowModal(false);\n    // Optionally clear buzzedPlayer if you want to reset it\n    setBuzzedPlayer(\"\");\n    if (isHost) {\n      resetBuzz(roomId);\n    }\n  };\n  useEffect(() => {\n    let hasMounted = false;\n    const unsubscribeBuzzing = listenToBuzzing(roomId, playerName => {\n      // if (!hasMounted) {\n      //     hasMounted = true; // skip initial\n      //     return;\n      // }\n      const audio = sounds['buzz'];\n      if (audio) {\n        audio.play();\n      }\n      console.log(\"playerName on host\", playerName);\n      console.log(\"listening on buzzing\");\n      if (playerName && playerName !== \"\") {\n        setBuzzedPlayer(playerName);\n        console.log(\"playerName\", typeof playerName);\n        console.log(playerName, \"đã bấm chuông\");\n        setShowModal(true); // Show modal when a player buzzes\n      }\n    });\n    return () => {\n      unsubscribeBuzzing();\n    };\n  }, [roomId]);\n  useEffect(() => {\n    const unsubscribePlayers = listenToSound(roomId, async type => {\n      const audio = sounds[`${type}`];\n      if (audio) {\n        audio.play();\n      }\n      console.log(\"sound type\", type);\n      await deletePath(roomId, \"sound\");\n    });\n\n    // No need to set state here; it's handled by useState initializer\n    return () => {\n      unsubscribePlayers();\n    };\n  }, []);\n  useEffect(() => {\n    const markedCharactersMap = {};\n    const highlightedMap = {};\n    if (hintWordArray) {\n      for (const word of hintWordArray) {\n        const presentArray = [];\n        for (let i = 0; i < word.length; i++) {\n          if (obstacleWord !== null && obstacleWord !== void 0 && obstacleWord.includes(word[i])) {\n            presentArray.push(i);\n          }\n        }\n        markedCharactersMap[word] = presentArray;\n\n        // Randomly pick up to 2 indices\n        const shuffled = [...presentArray].sort(() => Math.random() - 0.5);\n        highlightedMap[word] = shuffled.slice(0, 2);\n      }\n      setMarkedCharacters(markedCharactersMap);\n      setHighlightedCharacters(highlightedMap);\n    }\n  }, [hintWordArray, obstacleWord]);\n  useEffect(() => {\n    const generateInitialGrid = async () => {\n      if (hintWordArray) {\n        if (isHost) {\n          console.log(\"hintWordArray\", hintWordArray);\n          console.log(\"obstacle\", obstacleWord);\n          const result = await generateGrid(hintWordArray, 30);\n          console.log(\"board\", result.grid);\n          setHintWords(result.placementArray);\n          setGrid(result.grid);\n          const numberPositionArray = [];\n          result.grid.map((row, rowIndex) => row.map((cell, colIndex) => {\n            if (result.grid[rowIndex][colIndex].includes(\"number\")) {\n              numberPositionArray.push({\n                rowIndex: rowIndex,\n                colIndex: colIndex,\n                index: result.grid[rowIndex][colIndex].replace(\"number\", \"\")\n              });\n            }\n          }));\n          console.log(\"numberPositionArray\", numberPositionArray);\n          setNumberPositions(numberPositionArray);\n          const blankGrid = result.grid.map((row, rowIndex) => row.map((cell, colIndex) => result.grid[rowIndex][colIndex].includes(\"number\") ? cell :\n          // Keep \"numberX\"\n          cell !== \" \" && cell !== \"\" ? \"1\" : \"\" // Non-empty to \"1\", empty stays \"\"\n          ));\n          setInitialGrid(blankGrid);\n        }\n      }\n      if (initialGrid) {\n        setGrid(initialGrid);\n      }\n    };\n    generateInitialGrid();\n  }, [hintWordArray, obstacleWord, initialGrid]);\n  const menuRef = useRef(null);\n  const revealCells = (rowIndex, colIndex, action, hintWordNumber) => {\n    if (!isHost) return;\n    console.log(\"hintWordNumber\", hintWordNumber);\n    const hintWordIndex = hintWordNumber ? parseInt(hintWordNumber) : -1;\n    console.log(\"hintWordIndex\", hintWordIndex);\n    const hintWord = hintWords.find(word => word.index === hintWordIndex);\n    console.log(\"hintWord\", hintWord);\n    console.log(\"hintWords\", hintWords);\n    if (!hintWord) return;\n    const isRow = hintWord.dir === 1;\n    console.log(hintWord, \"is\", hintWord.dir);\n    const wordLength = hintWord.string.length - 2;\n    const startIndex = isRow ? colIndex + 1 : rowIndex + 1;\n    const handleNextQuestion = async (testName, hintWordIndex, round, roomId) => {\n      await getNextQuestion(testName, hintWordIndex, round, roomId);\n    };\n    setCellStyles(prev => {\n      const newStyles = {\n        ...prev\n      };\n      if (isRow) {\n        for (let col = startIndex; col < startIndex + wordLength; col++) {\n          if (col == GRID_SIZE) break;\n          const key = `${rowIndex}-${col}`;\n          // Skip number cells to preserve their appearance\n          console.log(\"grid[rowIndex][col]\", grid[rowIndex][col]);\n          console.log(\"rowIndex\", rowIndex);\n          console.log(\"col\", col);\n          if (!grid[rowIndex][col].includes(\"number\")) {\n            if (action === \"open\") {\n              newStyles[key] = {\n                background: \"bg-yellow-200\",\n                textColor: \"text-transparent\"\n              };\n              if (hintWordNumber) {\n                setSelectedRow(roomId, hintWordNumber, true, wordLength);\n                handleNextQuestion(testName, hintWordNumber.toString(), \"2\", roomId);\n              }\n            } else if (action === \"correct\" || action === \"all\") {\n              newStyles[key] = {\n                background: \"bg-yellow-200\",\n                textColor: \"text-black\"\n              };\n              let indexInTarget = [];\n              if (hintWordArray) for (let i = 2; i <= wordLength + 1; i++) {\n                const char = hintWord.char[i];\n                if (obstacleWord) {\n                  if (obstacleWord.includes(char)) {\n                    console.log(\"obstacleWord\", obstacleWord);\n                    console.log(\"char\", char);\n                    console.log(\"obstacleWord.includes(char)\", obstacleWord.includes(char));\n                    console.log(\"i\", i);\n                    console.log(\"i-2\", i - 2);\n                    indexInTarget.push(i - 2);\n                  }\n                }\n              }\n              if (hintWordArray && hintWordNumber) {\n                console.log(\"hintWordNumber\", hintWordNumber);\n                console.log(\"hintWord\", hintWord);\n                console.log(\"hintWord.string.slice(2, hintWord.string.length-1)\", hintWord.string.slice(2, hintWord.string.length - 1));\n                console.log(\"indexInTarget\", indexInTarget);\n                console.log(\"encodeURIComponent(JSON.stringify(indexInTarget))\", encodeURIComponent(JSON.stringify(indexInTarget)));\n                if (action === \"correct\") {\n                  setCorrectRow(roomId, hintWordNumber, hintWord.string.slice(2, hintWord.string.length - 1), encodeURIComponent(JSON.stringify(indexInTarget)), true, wordLength);\n                }\n              }\n            } else if (action === \"incorrect\") {\n              newStyles[key] = {\n                background: \"bg-gray-400\",\n                textColor: \"text-transparent\"\n              };\n              if (hintWordNumber) setIncorectRow(roomId, hintWordNumber, true, wordLength);\n            }\n          }\n        }\n      } else {\n        for (let row = startIndex; row < startIndex + wordLength; row++) {\n          if (row == GRID_SIZE) break;\n          const key = `${row}-${colIndex}`;\n          console.log(\"grid[row][colIndex]\", grid[row][colIndex]);\n          console.log(\"colIndex\", colIndex);\n          console.log(\"row\", row);\n          // Skip number cells to preserve their appearance\n          if (!grid[row][colIndex].includes(\"number\")) {\n            if (action === \"open\") {\n              newStyles[key] = {\n                background: \"bg-yellow-200\",\n                textColor: \"text-transparent\"\n              };\n              if (hintWordNumber) {\n                setSelectedRow(roomId, hintWordNumber, false, wordLength);\n                handleNextQuestion(testName, hintWordNumber.toString(), \"2\", roomId);\n              }\n            } else if (action === \"correct\" || action === \"all\") {\n              newStyles[key] = {\n                background: \"bg-yellow-200\",\n                textColor: \"text-black\"\n              };\n              let indexInTarget = [];\n              if (hintWordArray) for (let i = 2; i <= wordLength + 1; i++) {\n                const char = hintWord.char[i];\n                if (obstacleWord) {\n                  if (obstacleWord.includes(char)) {\n                    console.log(\"obstacleWord\", obstacleWord);\n                    console.log(\"char\", char);\n                    console.log(\"obstacleWord.includes(char)\", obstacleWord.includes(char));\n                    console.log(\"i\", i);\n                    console.log(\"i-2\", i - 2);\n                    indexInTarget.push(i - 2);\n                  }\n                }\n              }\n              if (hintWordArray && hintWordNumber && action === \"correct\") setCorrectRow(roomId, hintWordNumber, hintWord.string.slice(2, hintWord.string.length - 1), encodeURIComponent(JSON.stringify(indexInTarget)), false, wordLength);\n            } else if (action === \"incorrect\") {\n              newStyles[key] = {\n                background: \"bg-gray-400\",\n                textColor: \"text-transparent\"\n              };\n              if (hintWordNumber) setIncorectRow(roomId, hintWordNumber, false, wordLength);\n            }\n          }\n        }\n      }\n      return newStyles;\n    });\n\n    // if (action === \"correct\" || action === \"incorrect\") {\n    //   setSelectedRow(roomId, isRow ? rowIndex.toString() : colIndex.toString());\n    // }\n  };\n  const revealCellsForPlayer = (rowIndex, colIndex, action, selectedRowNumber, markedCharacterIndex, isRow, wordLength, correctAnswer // For correct\n  ) => {\n    if (isHost) return; // Ensure this runs only for players\n\n    // Determine word length\n    const length = action === \"correct\" ? (correctAnswer === null || correctAnswer === void 0 ? void 0 : correctAnswer.length) || 0 : wordLength || 0;\n    if (length === 0) {\n      console.warn(`No valid word length for row ${selectedRowNumber}`);\n      return;\n    }\n    setCellStyles(prev => {\n      const newStyles = {\n        ...prev\n      };\n      if (isRow) {\n        // Horizontal: style cells from colIndex + 1 to colIndex + length\n        for (let col = colIndex + 1; col <= colIndex + length; col++) {\n          var _grid$rowIndex$col;\n          const key = `${rowIndex}-${col}`;\n          console.log(\"markedCharacterIndex\", markedCharacterIndex);\n          console.log(\"col\", col);\n          console.log(\"col-colIndex\", col - colIndex - 1);\n          console.log(\"markedCharacterIndex.includes(col)\", markedCharacterIndex === null || markedCharacterIndex === void 0 ? void 0 : markedCharacterIndex.includes(col - colIndex));\n          console.log(`grid[${rowIndex}][${col}]`, grid[rowIndex][col]);\n\n          // Skip empty and number cells\n          if (grid[rowIndex][col] !== \"\" && !((_grid$rowIndex$col = grid[rowIndex][col]) !== null && _grid$rowIndex$col !== void 0 && _grid$rowIndex$col.includes(\"number\"))) {\n            if (action === \"open\") {\n              newStyles[key] = {\n                background: \"bg-yellow-200\",\n                textColor: \"text-transparent\"\n              };\n            } else if (action === \"incorrect\") {\n              newStyles[key] = {\n                background: \"bg-gray-400\",\n                textColor: \"text-transparent\"\n              };\n            } else if (action === \"correct\") {\n              newStyles[key] = {\n                background: \"bg-yellow-200\",\n                textColor: markedCharacterIndex !== null && markedCharacterIndex !== void 0 && markedCharacterIndex.includes(col - colIndex - 1) ? \"text-red-600\" : \"text-black\"\n              };\n            }\n          }\n        }\n      } else {\n        // Vertical: style cells from rowIndex + 1 to rowIndex + length\n        for (let row = rowIndex + 1; row <= rowIndex + length; row++) {\n          var _grid$row$colIndex;\n          const key = `${row}-${colIndex}`;\n          console.log(\"markedCharacterIndex\", markedCharacterIndex);\n          console.log(\"row\", row);\n          console.log(\"colIndex\", colIndex);\n          console.log(\"grid\", grid);\n          console.log(`grid[${row}][${colIndex}]`, grid[row][colIndex]);\n\n          // Skip empty and number cells\n          if (grid[row][colIndex] !== \"\" && !((_grid$row$colIndex = grid[row][colIndex]) !== null && _grid$row$colIndex !== void 0 && _grid$row$colIndex.includes(\"number\"))) {\n            if (action === \"open\") {\n              newStyles[key] = {\n                background: \"bg-yellow-200\",\n                textColor: \"text-transparent\"\n              };\n            } else if (action === \"incorrect\") {\n              newStyles[key] = {\n                background: \"bg-gray-400\",\n                textColor: \"text-transparent\"\n              };\n            } else if (action === \"correct\") {\n              newStyles[key] = {\n                background: \"bg-yellow-200\",\n                textColor: markedCharacterIndex !== null && markedCharacterIndex !== void 0 && markedCharacterIndex.includes(row - rowIndex - 1) ? \"text-red-600\" : \"text-black\"\n              };\n            }\n          }\n        }\n      }\n      return newStyles;\n    });\n\n    // For \"correct\", update grid to show the actual word\n    if (action === \"correct\" && correctAnswer) {\n      console.log(\"correctAnswer\", correctAnswer);\n      setGrid(prevGrid => {\n        const newGrid = prevGrid.map(row => [...row]);\n        if (isRow) {\n          for (let col = colIndex + 1, i = 0; col <= colIndex + length && i < correctAnswer.length; col++, i++) {\n            console.log(\"i\", i);\n            console.log(\"newGrid\", newGrid);\n            console.log(\"correctAnswer[i]\", correctAnswer[i]);\n            console.log(\"newGrid[rowIndex][col]\", newGrid[rowIndex][col]);\n            newGrid[rowIndex][col] = correctAnswer[i];\n          }\n        } else {\n          for (let row = rowIndex + 1, i = 0; row <= rowIndex + length && i < correctAnswer.length; row++, i++) {\n            console.log(\"correctAnswer[i]\", correctAnswer[i]);\n            console.log(\"newGrid[row][colIndex]\", newGrid[row][colIndex]);\n            console.log(\"i\", i);\n            console.log(\"newGrid\", newGrid);\n            newGrid[row][colIndex] = correctAnswer[i];\n          }\n        }\n        return newGrid;\n      });\n    }\n  };\n  const isFirstMounted = useRef(true);\n  useEffect(() => {\n    const unsubscribePlayers = listenToObstacle(roomId, data => {\n      // setCurrentQuestion(question)\n      // console.log(\"current question\", question)\n      if (isFirstMounted.current) {\n        isFirstMounted.current = false;\n        return;\n      }\n      const obstacleRevealed = {\n        \"question\": data.obstacle\n      };\n      setCurrentQuestion(obstacleRevealed);\n      const placementArray = data.placementArray;\n      console.log(\"placement array for player\", placementArray);\n      let rowIndex = -1;\n      let colIndex = -1;\n      for (let row = 0; row < grid.length; row++) {\n        for (let col = 0; col < grid[row].length; col++) {\n          if (grid[row][col] === `number${data.selected_row_number}`) {\n            rowIndex = row;\n            colIndex = col;\n            break;\n          }\n        }\n        if (rowIndex !== -1) break;\n      }\n      console.log(\"grid in obstacle\", grid);\n\n      // const numberPositions = data.numberPositions\n      for (var word of placementArray) {\n        revealCellsForPlayer(word.row_index, word.col_index, \"correct\", word.index, [], word.is_row, undefined, word.word);\n      }\n    });\n\n    // No need to set state here; it's handled by useState initializer\n    return () => {\n      unsubscribePlayers();\n    };\n  }, []);\n  useEffect(() => {\n    const unsubscribePlayers = listenToQuestions(roomId, question => {\n      setCurrentQuestion(question);\n      console.log(\"current question\", question);\n    });\n\n    // No need to set state here; it's handled by useState initializer\n    return () => {\n      unsubscribePlayers();\n    };\n  }, []);\n  // Listen for \"open\" (select) signal\n  useEffect(() => {\n    let isInitialCall = true;\n    const unsubscribeSelect = listenToSelectRow(roomId, data => {\n      if (isInitialCall) {\n        isInitialCall = false;\n        return; // Skip the initial snapshot\n      }\n      setAnswerList(null);\n      let rowIndex = -1;\n      let colIndex = -1;\n      for (let row = 0; row < grid.length; row++) {\n        for (let col = 0; col < grid[row].length; col++) {\n          if (grid[row][col] === `number${data.selected_row_number}`) {\n            rowIndex = row;\n            colIndex = col;\n            break;\n          }\n        }\n        if (rowIndex !== -1) break;\n      }\n      if (rowIndex === -1 || colIndex === -1) {\n        console.warn(`Number cell number${data.selected_row_number} not found`);\n        return;\n      }\n      revealCellsForPlayer(rowIndex, colIndex, \"open\", data.selected_row_number, [], data.is_row, data.word_length);\n    });\n    return () => {\n      unsubscribeSelect();\n    };\n  }, [roomId, grid]);\n\n  // Listen for \"incorrect\" signal\n  useEffect(() => {\n    let isInitialCall = true;\n    const unsubscribeIncorrect = listenToIncorrectRow(roomId, data => {\n      if (isInitialCall) {\n        isInitialCall = false;\n        return; // Skip the initial snapshot\n      }\n      const audio = sounds['wrong_2'];\n      if (audio) {\n        audio.play();\n      }\n      let rowIndex = -1;\n      let colIndex = -1;\n      for (let row = 0; row < grid.length; row++) {\n        for (let col = 0; col < grid[row].length; col++) {\n          if (grid[row][col] === `number${data.selected_row_number}`) {\n            rowIndex = row;\n            colIndex = col;\n            break;\n          }\n        }\n        if (rowIndex !== -1) break;\n      }\n      if (rowIndex === -1 || colIndex === -1) {\n        console.warn(`Number cell number${data.selected_row_number} not found`);\n        return;\n      }\n      revealCellsForPlayer(rowIndex, colIndex, \"incorrect\", data.selected_row_number, [], data.is_row, data.word_length);\n    });\n    return () => {\n      unsubscribeIncorrect();\n    };\n  }, [roomId, grid]);\n\n  // Listen for \"correct\" signal\n  useEffect(() => {\n    let isInitialCall = true;\n    const unsubscribeCorrect = listenToCorrectRow(roomId, data => {\n      console.log(\"isInitialCall\", isInitialCall);\n      if (isInitialCall) {\n        isInitialCall = false;\n        return; // Skip the initial snapshot\n      }\n      const audio = sounds['correct_2'];\n      if (audio) {\n        audio.play();\n      }\n      console.log(\"isInitialCall after\", isInitialCall);\n      let rowIndex = -1;\n      let colIndex = -1;\n      console.log(\"grid\", grid);\n      for (let row = 0; row < grid.length; row++) {\n        for (let col = 0; col < grid[row].length; col++) {\n          if (grid[row][col] === `number${data.selected_row_number}`) {\n            rowIndex = row;\n            colIndex = col;\n            break;\n          }\n        }\n        if (rowIndex !== -1) break;\n      }\n      if (rowIndex === -1 || colIndex === -1) {\n        console.warn(`Number cell number${data.selected_row_number} not found`);\n        return;\n      }\n      revealCellsForPlayer(rowIndex, colIndex, \"correct\", data.selected_row_number, data.marked_character_index, data.is_row, undefined, data.correct_answer);\n    });\n    return () => {\n      unsubscribeCorrect();\n    };\n  }, [roomId, grid]);\n\n  // Reveal cells in a row or column\n\n  // Handle number click to show menu\n  const handleNumberClick = (rowIndex, colIndex) => {\n    if (!isHost) return;\n    setMenu({\n      visible: true,\n      rowIndex,\n      colIndex\n    });\n  };\n\n  // Handle menu actions\n  const handleMenuAction = (action, rowIndex, colIndex, hintWordNumber) => {\n    revealCells(rowIndex, colIndex, action, hintWordNumber);\n    setMenu({\n      visible: false\n    });\n  };\n\n  // Handle cell click to reveal\n  const handleCellClick = (rowIndex, colIndex) => {\n    if (!isHost) return;\n    revealCells(rowIndex, colIndex, \"open\");\n  };\n  const handleOpenObstacle = async () => {\n    if (!isHost || !hintWords || !hintWordArray || !numberPositions) return;\n    console.log(\"hintWords in obstacle\", hintWords);\n    for (var word of hintWords) {\n      revealCells(word.x, word.y, \"all\", word.index.toString());\n    }\n    // for (let row = 0; row < grid.length; row++) {\n    //   for (let col = 0; col < grid[row].length; col++) {\n    //     if (Number.isFinite(Number(grid[row][col]))) {\n    //       revealCells(row, col, \"correct\", grid[row][col])\n    //     }\n    //   }\n    // }\n\n    const playerPlacementArray = hintWords.map(word => ({\n      \"row_index\": word.x,\n      \"col_index\": word.y,\n      \"index\": word.index,\n      \"is_row\": word.dir === 1 ? true : false,\n      \"word\": word.string.slice(2, word.string.length - 1)\n    }));\n    if (obstacleWord) {\n      await openObstacle(roomId, obstacleWord, playerPlacementArray);\n    }\n  };\n\n  // Close menu on outside click\n  useEffect(() => {\n    const handleClickOutside = event => {\n      if (menuRef.current && !menuRef.current.contains(event.target)) {\n        setMenu({\n          visible: false\n        });\n      }\n    };\n    document.addEventListener(\"mousedown\", handleClickOutside);\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"flex flex-col items-center bg-slate-800/80 backdrop-blur-sm rounded-xl border border-blue-400/30 shadow-2xl p-6 mb-4 relative\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"text-white text-xl font-semibold text-center mb-4 max-w-[90%]\",\n      children: typeof (currentQuestion === null || currentQuestion === void 0 ? void 0 : currentQuestion.question) === \"string\" ? currentQuestion.question : \"\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 828,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"grid  [grid-template-columns:repeat(var(--cols),32px)] [grid-auto-rows:max-content]  gap-1 max-h-[750px] overflow-y-auto overflow-visible\",\n      style: {\n        '--cols': ((_grid$ = grid[0]) === null || _grid$ === void 0 ? void 0 : _grid$.length) || 1\n      },\n      children: !grid || !Array.isArray(grid) || !grid.every(row => Array.isArray(row)) ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"text-white\",\n        children: \"Invalid grid data\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 838,\n        columnNumber: 11\n      }, this) : grid.map((row, rowIndex) => /*#__PURE__*/_jsxDEV(React.Fragment, {\n        children: row.map((cell, colIndex) => {\n          const cellKey = `${rowIndex}-${colIndex}`;\n          const cellStyle = cellStyles[cellKey] || {\n            background: cell === \"\" || cell === \" \" ? \"transparent\" : \"bg-white\",\n            textColor: cell.includes(\"number\") ? \"text-blue-400\" : \"text-transparent\"\n          };\n          const showMenu = menu.visible && menu.rowIndex === rowIndex && menu.colIndex === colIndex && cell.includes(\"number\");\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"relative w-8 h-8 flex items-center justify-center overflow-visible\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: `w-8 h-8 flex items-center justify-center text-lg font-semibold select-none rounded-lg overflow-visible   \n                  ${cell.includes(\"number\") ? \"text-blue-400 border-none\" : \"\"}\n                  ${cell.includes(\"number\") ? \"\" : cellStyle.background}\n                  ${cell.includes(\"number\") ? \"text-blue-400\" : cellStyle.textColor}\n                  ${obstacleWord !== null && obstacleWord !== void 0 && obstacleWord.includes(cell) && cellStyle.textColor === \"text-black\" && !cell.includes(\"number\") && isNaN(Number(cell)) ? \"font-bold text-red-400\" : \"\"}\n                `,\n              onClick: () => {\n                if (isHost) {\n                  if (cell.includes(\"number\")) {\n                    handleNumberClick(rowIndex, colIndex);\n                  } else {\n                    handleCellClick(rowIndex, colIndex);\n                  }\n                }\n              },\n              style: {\n                cursor: isHost && (cell.includes(\"number\") || hintWords.some(word => word.y === rowIndex || word.x === colIndex)) ? \"pointer\" : \"default\"\n              },\n              children: typeof cell === \"string\" || typeof cell === \"number\" ? cell.includes(\"number\") ? cell.replace(\"number\", \"\") : cell : \"\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 858,\n              columnNumber: 21\n            }, this), showMenu && /*#__PURE__*/_jsxDEV(\"div\", {\n              ref: menuRef,\n              className: \"absolute left-12 top-1/2 transform -translate-y-1/2 flex space-x-2 bg-slate-900 border border-blue-400/50 rounded shadow-lg p-1 z-10\",\n              children: [/*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"px-2 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600\",\n                onClick: () => handleMenuAction(\"open\", rowIndex, colIndex, cell.replace(\"number\", \"\")),\n                children: \"SELECT\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 900,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"px-2 py-1 text-sm bg-green-500 text-white rounded hover:bg-green-600\",\n                onClick: () => handleMenuAction(\"correct\", rowIndex, colIndex, cell.replace(\"number\", \"\")),\n                children: \"Correct\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 908,\n                columnNumber: 25\n              }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"px-2 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600\",\n                onClick: () => handleMenuAction(\"incorrect\", rowIndex, colIndex, cell.replace(\"number\", \"\")),\n                children: \"Incorrect\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 916,\n                columnNumber: 25\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 896,\n              columnNumber: 23\n            }, this)]\n          }, colIndex, true, {\n            fileName: _jsxFileName,\n            lineNumber: 857,\n            columnNumber: 19\n          }, this);\n        })\n      }, rowIndex, false, {\n        fileName: _jsxFileName,\n        lineNumber: 841,\n        columnNumber: 13\n      }, this))\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 833,\n      columnNumber: 7\n    }, this), !isSpectator && /*#__PURE__*/_jsxDEV(PlayerAnswerInput, {\n      isHost: isHost,\n      question: currentQuestion\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 934,\n      columnNumber: 11\n    }, this), isHost && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"flex gap-2 mt-4 w-full\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => {\n          alert('Mở cnv!');\n          handleOpenObstacle();\n        },\n        className: \"bg-indigo-600 hover:bg-indigo-700 text-white p-2 flex-1 rounded-md whitespace-nowrap\",\n        children: \"M\\u1EDF CNV\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 944,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => {\n          handleSuffleGrid();\n        },\n        className: \"bg-indigo-600 hover:bg-indigo-700 text-white p-2 flex-1 rounded-md whitespace-nowrap\",\n        children: \"X\\xE1o tr\\u1ED9n h\\xE0ng ngang\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 953,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 943,\n      columnNumber: 11\n    }, this), showModal && buzzedPlayer && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white rounded-lg p-6 w-80 shadow-lg\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-lg font-semibold text-gray-800 mb-4 text-center\",\n          children: `${buzzedPlayer} đã nhấn chuông trả lời`\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 968,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-center\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleCloseModal,\n            className: \"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400\",\n            children: \"\\u0110\\xF3ng\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 972,\n            columnNumber: 15\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 971,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 967,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 966,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 827,\n    columnNumber: 5\n  }, this);\n};\n_s(QuestionBoxRound2, \"eYqGvuaCcrZVKDq886GGOj1NAS0=\", false, function () {\n  return [useTimeStart, useSounds, useSearchParams, usePlayer];\n});\n_c = QuestionBoxRound2;\nexport default QuestionBoxRound2;\nvar _c;\n$RefreshReg$(_c, \"QuestionBoxRound2\");","map":{"version":3,"names":["React","useState","useEffect","useRef","usePlayer","setSelectedRow","setCorrectRow","setIncorectRow","deletePath","listenToTimeStart","listenToBuzzing","listenToSound","listenToCorrectRow","listenToIncorrectRow","listenToSelectRow","listenToQuestions","listenToObstacle","useSearchParams","getNextQuestion","openObstacle","generateGrid","PlayerAnswerInput","useSounds","resetBuzz","useTimeStart","submitAnswer","jsxDEV","_jsxDEV","mainKeyword","QuestionBoxRound2","obstacleWord","hintWordArray","initialGrid","isSpectator","isHost","_s","_grid$","console","log","startTimer","timeLeft","setTimeLeft","sounds","searchParams","setInitialGrid","animationKey","setAnimationKey","playerAnswerRef","position","setAnswerList","numberPositions","setNumberPositions","roomId","get","testName","GRID_SIZE","grid","setGrid","hintWords","setHintWords","currentQuestion","setCurrentQuestion","buzzedPlayer","setBuzzedPlayer","cellStyles","setCellStyles","menu","setMenu","visible","hintWordsLength","setHintWordsLength","markedCharacters","setMarkedCharacters","highlightedCharacters","setHighlightedCharacters","showModal","setShowModal","isInitialTimerMount","current","prev","isInitialMount","unsubscribe","handleSuffleGrid","result","topBound","bottomBound","placementArray","numberPositionArray","map","row","rowIndex","cell","colIndex","includes","push","index","replace","blankGrid","handleCloseModal","hasMounted","unsubscribeBuzzing","playerName","audio","play","unsubscribePlayers","type","markedCharactersMap","highlightedMap","word","presentArray","i","length","shuffled","sort","Math","random","slice","generateInitialGrid","menuRef","revealCells","action","hintWordNumber","hintWordIndex","parseInt","hintWord","find","isRow","dir","wordLength","string","startIndex","handleNextQuestion","round","newStyles","col","key","background","textColor","toString","indexInTarget","char","encodeURIComponent","JSON","stringify","revealCellsForPlayer","selectedRowNumber","markedCharacterIndex","correctAnswer","warn","_grid$rowIndex$col","_grid$row$colIndex","prevGrid","newGrid","isFirstMounted","data","obstacleRevealed","obstacle","selected_row_number","row_index","col_index","is_row","undefined","question","isInitialCall","unsubscribeSelect","word_length","unsubscribeIncorrect","unsubscribeCorrect","marked_character_index","correct_answer","handleNumberClick","handleMenuAction","handleCellClick","handleOpenObstacle","x","y","playerPlacementArray","handleClickOutside","event","contains","target","document","addEventListener","removeEventListener","className","children","fileName","_jsxFileName","lineNumber","columnNumber","style","Array","isArray","every","Fragment","cellKey","cellStyle","showMenu","isNaN","Number","onClick","cursor","some","ref","alert","_c","$RefreshReg$"],"sources":["C:/Users/ASUS/Documents/htm_fe/src/layouts/RoundBase/Round2.tsx"],"sourcesContent":["import Play from \"../Play\";\r\nimport React, { useState, useEffect, useRef } from \"react\";\r\nimport { renderGrid } from \"./utils\";\r\nimport { usePlayer } from \"../../context/playerContext\";\r\nimport { setSelectedRow, setCorrectRow, setIncorectRow } from \"../../components/services\";\r\nimport { deletePath, listenToTimeStart, listenToBuzzing, listenToSound, listenToCorrectRow, listenToIncorrectRow, listenToSelectRow, listenToQuestions, listenToObstacle } from \"../../services/firebaseServices\";\r\nimport { useSearchParams } from \"react-router-dom\";\r\nimport { getNextQuestion } from \"../../pages/Host/Test/service\";\r\nimport { openObstacle } from \"../../components/services\";\r\nimport { generateGrid } from \"../../pages/User/Round2/utils\";\r\nimport PlayerAnswerInput from \"../../components/ui/PlayerAnswerInput\";\r\nimport { Question } from \"../../type\";\r\nimport { useSounds } from \"../../context/soundContext\";\r\nimport { resetBuzz } from \"../../components/services\";\r\nimport { useTimeStart } from \"../../context/timeListenerContext\";\r\nimport { submitAnswer } from \"../services\";\r\ninterface HintWord {\r\n  word: string;\r\n  x: number;\r\n  y: number;\r\n  direction: \"horizontal\" | \"vertical\";\r\n}\r\n\r\n\r\n\r\ninterface MatchPosition {\r\n  x: number;\r\n  y: number;\r\n  dir: number;\r\n}\r\n\r\ninterface WordObj {\r\n  string: string;\r\n  char: string[];\r\n  totalMatches: number;\r\n  effectiveMatches: number;\r\n  successfulMatches: MatchPosition[];\r\n  x: number;\r\n  y: number;\r\n  dir: number;\r\n  index: number;\r\n};\r\n\r\n\r\ninterface ObstacleQuestionBoxProps {\r\n  obstacleWord?: string;\r\n  hintWordArray?: string[];\r\n  isHost?: boolean;\r\n  initialGrid?: string[][];\r\n  isSpectator?: boolean;\r\n}\r\n\r\ninterface QuestionBoxProps {\r\n  question: string;\r\n  imageUrl?: string;\r\n  isHost?: boolean\r\n}\r\n\r\nconst mainKeyword = \"BÒCÔNGANH\";\r\n\r\nconst QuestionBoxRound2: React.FC<ObstacleQuestionBoxProps> = ({\r\n  obstacleWord,\r\n  hintWordArray,\r\n  initialGrid,\r\n  isSpectator = false,\r\n  isHost = false,\r\n}) => {\r\n  console.log(\"initialGrid inside player\", initialGrid);\r\n  const { startTimer, timeLeft, setTimeLeft } = useTimeStart();\r\n  const sounds = useSounds();\r\n  const [searchParams] = useSearchParams();\r\n  const { setInitialGrid, animationKey, setAnimationKey, playerAnswerRef, position, setAnswerList } = usePlayer();\r\n  const [numberPositions, setNumberPositions] = useState<{\r\n    rowIndex: number,\r\n    colIndex: number,\r\n    index: string\r\n  }[]>([])\r\n  const roomId = searchParams.get(\"roomId\") || \"\";\r\n  const testName = searchParams.get(\"testName\") || \"\"\r\n  const GRID_SIZE = 30;\r\n\r\n  const [grid, setGrid] = useState<string[][]>([[]]);\r\n  const [hintWords, setHintWords] = useState<WordObj[]>([]);\r\n  const [currentQuestion, setCurrentQuestion] = useState<Question>()\r\n  const [buzzedPlayer, setBuzzedPlayer] = useState<string>(\"\");\r\n\r\n  const [cellStyles, setCellStyles] = useState<\r\n    Record<string, { background: string; textColor: string }>\r\n  >({}); // Tracks background and text styles\r\n  const [menu, setMenu] = useState<{\r\n    visible: boolean;\r\n    rowIndex?: number;\r\n    colIndex?: number;\r\n  }>({ visible: false });\r\n  const [hintWordsLength, setHintWordsLength] = useState<number[]>([]);\r\n  const [markedCharacters, setMarkedCharacters] = useState<Record<string, number[]>>({});\r\n  const [highlightedCharacters, setHighlightedCharacters] = useState<Record<string, number[]>>({});\r\n  const [showModal, setShowModal] = useState(false);\r\n  const isInitialTimerMount = useRef(false)\r\n  useEffect(() => {\r\n    console.log(\"timeLeft\", timeLeft);\r\n    if (isInitialTimerMount.current) {\r\n      isInitialTimerMount.current = false;\r\n      return;\r\n    }\r\n    if (timeLeft === 0) {\r\n      submitAnswer(roomId, playerAnswerRef.current, position)\r\n\r\n      setAnimationKey((prev: number) => prev + 1);\r\n\r\n      // If you want to reset timer, call startTimer again here or leave stopped\r\n    }\r\n  }, [timeLeft]);\r\n\r\n  const isInitialMount = useRef(false)\r\n  useEffect(() => {\r\n    const unsubscribe = listenToTimeStart(roomId, async () => {\r\n\r\n\r\n      // Skip the timer setting on the first mount, but allow future calls to run\r\n      if (isInitialMount.current) {\r\n        isInitialMount.current = false;\r\n        return;\r\n      }\r\n      startTimer(15)\r\n      return () => {\r\n        unsubscribe();\r\n\r\n      };\r\n    })\r\n\r\n  }, [])\r\n  const handleSuffleGrid = async () => {\r\n    if (isHost && hintWordArray) {\r\n      const result = await generateGrid(hintWordArray, 30)\r\n      console.log(\"board\", result.grid);\r\n      let topBound = 0\r\n      let bottomBound = 0\r\n\r\n      setHintWords(result.placementArray)\r\n      setGrid(result.grid)\r\n      const numberPositionArray: any = []\r\n      result.grid.map((row, rowIndex) =>\r\n        row.map((cell, colIndex) => {\r\n          if (result.grid[rowIndex][colIndex].includes(\"number\")) {\r\n            numberPositionArray.push({\r\n              rowIndex: rowIndex,\r\n              colIndex: colIndex,\r\n              index: result.grid[rowIndex][colIndex].replace(\"number\", \"\")\r\n            })\r\n          }\r\n        }\r\n        )\r\n      );\r\n      const blankGrid = result.grid.map((row, rowIndex) =>\r\n        row.map((cell, colIndex) =>\r\n          result.grid[rowIndex][colIndex].includes(\"number\") ? cell : // Keep \"numberX\"\r\n            (cell !== \" \" && cell !== \"\") ? \"1\" : \"\" // Non-empty to \"1\", empty stays \"\"\r\n        )\r\n      );\r\n      setInitialGrid(blankGrid)\r\n    }\r\n\r\n  }\r\n\r\n  // const isInitialMount = true;\r\n  // useEffect(() => {\r\n  //       if (isInitialMount) return\r\n\r\n\r\n  //       // Start timer when selectedTopic changes\r\n  //       startTimer(15);\r\n\r\n  //       return () => {  \r\n\r\n\r\n  //       }\r\n\r\n  //       // Side effects based on timer reaching 0\r\n  //   }, []);\r\n\r\n  const handleCloseModal = () => {\r\n    setShowModal(false);\r\n    // Optionally clear buzzedPlayer if you want to reset it\r\n    setBuzzedPlayer(\"\");\r\n\r\n    if (isHost) {\r\n      resetBuzz(roomId)\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n\r\n    let hasMounted = false;\r\n    const unsubscribeBuzzing = listenToBuzzing(roomId, (playerName) => {\r\n      // if (!hasMounted) {\r\n      //     hasMounted = true; // skip initial\r\n      //     return;\r\n      // }\r\n      const audio = sounds['buzz'];\r\n      if (audio) {\r\n        audio.play();\r\n      }\r\n      console.log(\"playerName on host\", playerName);\r\n\r\n      console.log(\"listening on buzzing\");\r\n\r\n      if (playerName && playerName !== \"\") {\r\n        setBuzzedPlayer(playerName);\r\n        console.log(\"playerName\", typeof playerName);\r\n\r\n        console.log(playerName, \"đã bấm chuông\")\r\n        setShowModal(true); // Show modal when a player buzzes\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      unsubscribeBuzzing();\r\n    };\r\n  }, [roomId]);\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    const unsubscribePlayers = listenToSound(roomId, async (type) => {\r\n\r\n      const audio = sounds[`${type}`];\r\n      if (audio) {\r\n        audio.play();\r\n      }\r\n      console.log(\"sound type\", type)\r\n      await deletePath(roomId, \"sound\")\r\n    });\r\n\r\n    // No need to set state here; it's handled by useState initializer\r\n    return () => {\r\n      unsubscribePlayers();\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const markedCharactersMap: Record<string, number[]> = {};\r\n    const highlightedMap: Record<string, number[]> = {};\r\n\r\n    if (hintWordArray) {\r\n      for (const word of hintWordArray) {\r\n        const presentArray: number[] = [];\r\n\r\n        for (let i = 0; i < word.length; i++) {\r\n          if (obstacleWord?.includes(word[i])) {\r\n            presentArray.push(i);\r\n          }\r\n        }\r\n\r\n        markedCharactersMap[word] = presentArray;\r\n\r\n        // Randomly pick up to 2 indices\r\n        const shuffled = [...presentArray].sort(() => Math.random() - 0.5);\r\n        highlightedMap[word] = shuffled.slice(0, 2);\r\n      }\r\n\r\n      setMarkedCharacters(markedCharactersMap);\r\n      setHighlightedCharacters(highlightedMap);\r\n    }\r\n  }, [hintWordArray, obstacleWord]);\r\n\r\n  useEffect(() => {\r\n    const generateInitialGrid = async () => {\r\n      if (hintWordArray) {\r\n        if (isHost) {\r\n          console.log(\"hintWordArray\", hintWordArray);\r\n          console.log(\"obstacle\", obstacleWord);\r\n\r\n          const result = await generateGrid(hintWordArray, 30)\r\n          console.log(\"board\", result.grid);\r\n          setHintWords(result.placementArray)\r\n          setGrid(result.grid)\r\n          const numberPositionArray: any = []\r\n\r\n          result.grid.map((row, rowIndex) =>\r\n            row.map((cell, colIndex) => {\r\n              if (result.grid[rowIndex][colIndex].includes(\"number\")) {\r\n                numberPositionArray.push({\r\n                  rowIndex: rowIndex,\r\n                  colIndex: colIndex,\r\n                  index: result.grid[rowIndex][colIndex].replace(\"number\", \"\")\r\n                })\r\n              }\r\n            }\r\n            )\r\n          );\r\n          console.log(\"numberPositionArray\", numberPositionArray);\r\n\r\n          setNumberPositions(numberPositionArray)\r\n\r\n          const blankGrid = result.grid.map((row, rowIndex) =>\r\n            row.map((cell, colIndex) =>\r\n              result.grid[rowIndex][colIndex].includes(\"number\") ? cell : // Keep \"numberX\"\r\n                (cell !== \" \" && cell !== \"\") ? \"1\" : \"\" // Non-empty to \"1\", empty stays \"\"\r\n            )\r\n          );\r\n          setInitialGrid(blankGrid)\r\n        }\r\n      }\r\n\r\n      if (initialGrid) {\r\n        setGrid(initialGrid)\r\n      }\r\n    }\r\n\r\n    generateInitialGrid()\r\n  }, [hintWordArray, obstacleWord, initialGrid])\r\n\r\n  const menuRef = useRef<HTMLDivElement>(null);\r\n\r\n  const revealCells = (\r\n    rowIndex: number,\r\n    colIndex: number,\r\n    action: \"open\" | \"correct\" | \"incorrect\" | \"all\",\r\n    hintWordNumber?: string\r\n  ) => {\r\n    if (!isHost) return;\r\n    console.log(\"hintWordNumber\", hintWordNumber);\r\n\r\n    const hintWordIndex = hintWordNumber ? parseInt(hintWordNumber) : -1;\r\n\r\n    console.log(\"hintWordIndex\", hintWordIndex);\r\n\r\n    const hintWord = hintWords.find(\r\n      (word) =>\r\n        (word.index === hintWordIndex)\r\n    );\r\n\r\n    console.log(\"hintWord\", hintWord);\r\n    console.log(\"hintWords\", hintWords);\r\n\r\n\r\n    if (!hintWord) return;\r\n\r\n    const isRow = hintWord.dir === 1;\r\n    console.log(hintWord, \"is\", hintWord.dir);\r\n\r\n    const wordLength = hintWord.string.length - 2;\r\n    const startIndex = isRow ? colIndex + 1 : rowIndex + 1;\r\n\r\n    const handleNextQuestion = async (testName: string, hintWordIndex: string, round: string, roomId: string) => {\r\n      await getNextQuestion(testName, hintWordIndex, round, roomId)\r\n    }\r\n\r\n    setCellStyles((prev) => {\r\n      const newStyles = { ...prev };\r\n      if (isRow) {\r\n        for (let col = startIndex; col < startIndex + wordLength; col++) {\r\n          if (col == GRID_SIZE) break\r\n          const key = `${rowIndex}-${col}`;\r\n          // Skip number cells to preserve their appearance\r\n          console.log(\"grid[rowIndex][col]\", grid[rowIndex][col])\r\n          console.log(\"rowIndex\", rowIndex);\r\n          console.log(\"col\", col);\r\n\r\n          if (!grid[rowIndex][col].includes(\"number\")) {\r\n            if (action === \"open\") {\r\n              newStyles[key] = { background: \"bg-yellow-200\", textColor: \"text-transparent\" };\r\n              if (hintWordNumber) {\r\n                setSelectedRow(roomId, hintWordNumber, true, wordLength)\r\n                handleNextQuestion(testName, hintWordNumber.toString(), \"2\", roomId)\r\n              }\r\n            } else if (action === \"correct\" || action === \"all\") {\r\n              newStyles[key] = { background: \"bg-yellow-200\", textColor: \"text-black\" };\r\n              let indexInTarget = []\r\n              if (hintWordArray)\r\n                for (let i = 2; i <= wordLength + 1; i++) {\r\n                  const char = hintWord.char[i];\r\n\r\n\r\n                  if (obstacleWord) {\r\n                    if (obstacleWord.includes(char)) {\r\n                      console.log(\"obstacleWord\", obstacleWord);\r\n                      console.log(\"char\", char);\r\n                      console.log(\"obstacleWord.includes(char)\", obstacleWord.includes(char));\r\n                      console.log(\"i\", i);\r\n                      console.log(\"i-2\", i - 2);\r\n\r\n\r\n\r\n                      indexInTarget.push(i - 2)\r\n                    }\r\n                  }\r\n                }\r\n              if (hintWordArray && hintWordNumber) {\r\n                console.log(\"hintWordNumber\", hintWordNumber);\r\n                console.log(\"hintWord\", hintWord);\r\n                console.log(\"hintWord.string.slice(2, hintWord.string.length-1)\", hintWord.string.slice(2, hintWord.string.length - 1));\r\n                console.log(\"indexInTarget\", indexInTarget);\r\n                console.log(\"encodeURIComponent(JSON.stringify(indexInTarget))\", encodeURIComponent(JSON.stringify(indexInTarget)),);\r\n\r\n\r\n\r\n                if (action === \"correct\") {\r\n                  setCorrectRow(roomId, hintWordNumber, hintWord.string.slice(2, hintWord.string.length - 1), encodeURIComponent(JSON.stringify(indexInTarget)), true, wordLength)\r\n                }\r\n              }\r\n            } else if (action === \"incorrect\") {\r\n              newStyles[key] = { background: \"bg-gray-400\", textColor: \"text-transparent\" };\r\n              if (hintWordNumber)\r\n                setIncorectRow(roomId, hintWordNumber, true, wordLength)\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        for (let row = startIndex; row < startIndex + wordLength; row++) {\r\n          if (row == GRID_SIZE) break\r\n          const key = `${row}-${colIndex}`;\r\n          console.log(\"grid[row][colIndex]\", grid[row][colIndex])\r\n          console.log(\"colIndex\", colIndex);\r\n          console.log(\"row\", row);\r\n          // Skip number cells to preserve their appearance\r\n          if (!grid[row][colIndex].includes(\"number\")) {\r\n            if (action === \"open\") {\r\n              newStyles[key] = { background: \"bg-yellow-200\", textColor: \"text-transparent\" };\r\n              if (hintWordNumber) {\r\n                setSelectedRow(roomId, hintWordNumber, false, wordLength)\r\n                handleNextQuestion(testName, hintWordNumber.toString(), \"2\", roomId)\r\n              }\r\n            } else if (action === \"correct\" || action === \"all\") {\r\n              newStyles[key] = { background: \"bg-yellow-200\", textColor: \"text-black\" };\r\n              let indexInTarget = []\r\n              if (hintWordArray)\r\n                for (let i = 2; i <= wordLength + 1; i++) {\r\n                  const char = hintWord.char[i];\r\n\r\n                  if (obstacleWord) {\r\n                    if (obstacleWord.includes(char)) {\r\n                      console.log(\"obstacleWord\", obstacleWord);\r\n                      console.log(\"char\", char);\r\n                      console.log(\"obstacleWord.includes(char)\", obstacleWord.includes(char));\r\n                      console.log(\"i\", i);\r\n                      console.log(\"i-2\", i - 2);\r\n\r\n                      indexInTarget.push(i - 2)\r\n                    }\r\n                  }\r\n                }\r\n              if (hintWordArray && hintWordNumber && action === \"correct\")\r\n                setCorrectRow(roomId, hintWordNumber, hintWord.string.slice(2, hintWord.string.length - 1), encodeURIComponent(JSON.stringify(indexInTarget)), false, wordLength)\r\n            } else if (action === \"incorrect\") {\r\n              newStyles[key] = { background: \"bg-gray-400\", textColor: \"text-transparent\" };\r\n              if (hintWordNumber)\r\n                setIncorectRow(roomId, hintWordNumber, false, wordLength)\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return newStyles;\r\n    });\r\n\r\n    // if (action === \"correct\" || action === \"incorrect\") {\r\n    //   setSelectedRow(roomId, isRow ? rowIndex.toString() : colIndex.toString());\r\n    // }\r\n  };\r\n\r\n\r\n  const revealCellsForPlayer = (\r\n    rowIndex: number,\r\n    colIndex: number,\r\n    action: \"open\" | \"incorrect\" | \"correct\",\r\n    selectedRowNumber: string,\r\n    markedCharacterIndex?: number[],\r\n    isRow?: boolean,\r\n    wordLength?: number, // For open and incorrect\r\n    correctAnswer?: string, // For correct\r\n  ) => {\r\n    if (isHost) return; // Ensure this runs only for players\r\n\r\n    // Determine word length\r\n    const length = action === \"correct\" ? correctAnswer?.length || 0 : wordLength || 0;\r\n\r\n    if (length === 0) {\r\n      console.warn(`No valid word length for row ${selectedRowNumber}`);\r\n      return;\r\n    }\r\n\r\n    setCellStyles((prev) => {\r\n      const newStyles = { ...prev };\r\n      if (isRow) {\r\n        // Horizontal: style cells from colIndex + 1 to colIndex + length\r\n        for (let col = colIndex + 1; col <= colIndex + length; col++) {\r\n          const key = `${rowIndex}-${col}`;\r\n          console.log(\"markedCharacterIndex\", markedCharacterIndex);\r\n          console.log(\"col\", col);\r\n          console.log(\"col-colIndex\", col - colIndex - 1);\r\n\r\n          console.log(\"markedCharacterIndex.includes(col)\", markedCharacterIndex?.includes(col - colIndex));\r\n          console.log(`grid[${rowIndex}][${col}]`, grid[rowIndex][col]);\r\n\r\n\r\n          // Skip empty and number cells\r\n          if (grid[rowIndex][col] !== \"\" && !grid[rowIndex][col]?.includes(\"number\")) {\r\n            if (action === \"open\") {\r\n              newStyles[key] = { background: \"bg-yellow-200\", textColor: \"text-transparent\" };\r\n            } else if (action === \"incorrect\") {\r\n              newStyles[key] = { background: \"bg-gray-400\", textColor: \"text-transparent\" };\r\n            } else if (action === \"correct\") {\r\n              newStyles[key] = {\r\n                background: \"bg-yellow-200\",\r\n                textColor: markedCharacterIndex?.includes(col - colIndex - 1) ? \"text-red-600\" : \"text-black\"\r\n              };\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        // Vertical: style cells from rowIndex + 1 to rowIndex + length\r\n        for (let row = rowIndex + 1; row <= rowIndex + length; row++) {\r\n          const key = `${row}-${colIndex}`;\r\n          console.log(\"markedCharacterIndex\", markedCharacterIndex);\r\n          console.log(\"row\", row);\r\n          console.log(\"colIndex\", colIndex);\r\n          console.log(\"grid\", grid);\r\n\r\n          console.log(`grid[${row}][${colIndex}]`, grid[row][colIndex]);\r\n\r\n          // Skip empty and number cells\r\n          if (grid[row][colIndex] !== \"\" && !grid[row][colIndex]?.includes(\"number\")) {\r\n            if (action === \"open\") {\r\n              newStyles[key] = { background: \"bg-yellow-200\", textColor: \"text-transparent\" };\r\n            } else if (action === \"incorrect\") {\r\n              newStyles[key] = { background: \"bg-gray-400\", textColor: \"text-transparent\" };\r\n            } else if (action === \"correct\") {\r\n              newStyles[key] = {\r\n                background: \"bg-yellow-200\",\r\n                textColor: markedCharacterIndex?.includes(row - rowIndex - 1) ? \"text-red-600\" : \"text-black\"\r\n              };\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return newStyles;\r\n    });\r\n\r\n    // For \"correct\", update grid to show the actual word\r\n    if (action === \"correct\" && correctAnswer) {\r\n      console.log(\"correctAnswer\", correctAnswer);\r\n\r\n      setGrid((prevGrid) => {\r\n        const newGrid = prevGrid.map((row) => [...row]);\r\n        if (isRow) {\r\n          for (let col = colIndex + 1, i = 0; col <= colIndex + length && i < correctAnswer.length; col++, i++) {\r\n            console.log(\"i\", i);\r\n            console.log(\"newGrid\", newGrid);\r\n\r\n\r\n            console.log(\"correctAnswer[i]\", correctAnswer[i]);\r\n            console.log(\"newGrid[rowIndex][col]\", newGrid[rowIndex][col]);\r\n\r\n            newGrid[rowIndex][col] = correctAnswer[i];\r\n          }\r\n        } else {\r\n          for (let row = rowIndex + 1, i = 0; row <= rowIndex + length && i < correctAnswer.length; row++, i++) {\r\n            console.log(\"correctAnswer[i]\", correctAnswer[i]);\r\n            console.log(\"newGrid[row][colIndex]\", newGrid[row][colIndex]);\r\n            console.log(\"i\", i);\r\n            console.log(\"newGrid\", newGrid);\r\n\r\n            newGrid[row][colIndex] = correctAnswer[i];\r\n          }\r\n        }\r\n        return newGrid;\r\n      });\r\n    }\r\n  };\r\n\r\n\r\n  const isFirstMounted = useRef(true)\r\n  useEffect(() => {\r\n    const unsubscribePlayers = listenToObstacle(roomId, (data) => {\r\n      // setCurrentQuestion(question)\r\n      // console.log(\"current question\", question)\r\n      if (isFirstMounted.current) {\r\n        isFirstMounted.current = false\r\n        return\r\n      }\r\n      const obstacleRevealed = {\r\n        \"question\": data.obstacle\r\n      }\r\n      setCurrentQuestion(obstacleRevealed)\r\n      const placementArray = data.placementArray\r\n\r\n      console.log(\"placement array for player\", placementArray);\r\n\r\n      let rowIndex = -1;\r\n      let colIndex = -1;\r\n      for (let row = 0; row < grid.length; row++) {\r\n        for (let col = 0; col < grid[row].length; col++) {\r\n          if (grid[row][col] === `number${data.selected_row_number}`) {\r\n            rowIndex = row;\r\n            colIndex = col;\r\n            break;\r\n          }\r\n        }\r\n        if (rowIndex !== -1) break;\r\n      }\r\n\r\n      console.log(\"grid in obstacle\", grid);\r\n      \r\n      // const numberPositions = data.numberPositions\r\n      for (var word of placementArray) {\r\n        revealCellsForPlayer(word.row_index, word.col_index, \"correct\", word.index, [], word.is_row, undefined, word.word)\r\n      }\r\n    });\r\n\r\n    // No need to set state here; it's handled by useState initializer\r\n    return () => {\r\n      unsubscribePlayers();\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const unsubscribePlayers = listenToQuestions(roomId, (question) => {\r\n      setCurrentQuestion(question)\r\n      console.log(\"current question\", question)\r\n\r\n    });\r\n\r\n    // No need to set state here; it's handled by useState initializer\r\n    return () => {\r\n      unsubscribePlayers();\r\n    };\r\n  }, []);\r\n  // Listen for \"open\" (select) signal\r\n  useEffect(() => {\r\n    let isInitialCall = true;\r\n    const unsubscribeSelect = listenToSelectRow(roomId, (data) => {\r\n\r\n      if (isInitialCall) {\r\n        isInitialCall = false;\r\n        return; // Skip the initial snapshot\r\n      }\r\n      setAnswerList(null)\r\n\r\n      let rowIndex = -1;\r\n      let colIndex = -1;\r\n      for (let row = 0; row < grid.length; row++) {\r\n        for (let col = 0; col < grid[row].length; col++) {\r\n          if (grid[row][col] === `number${data.selected_row_number}`) {\r\n            rowIndex = row;\r\n            colIndex = col;\r\n            break;\r\n          }\r\n        }\r\n        if (rowIndex !== -1) break;\r\n      }\r\n\r\n      if (rowIndex === -1 || colIndex === -1) {\r\n        console.warn(`Number cell number${data.selected_row_number} not found`);\r\n        return;\r\n      }\r\n\r\n      revealCellsForPlayer(rowIndex, colIndex, \"open\", data.selected_row_number, [], data.is_row, data.word_length);\r\n    });\r\n\r\n    return () => {\r\n      unsubscribeSelect();\r\n    };\r\n  }, [roomId, grid]);\r\n\r\n  // Listen for \"incorrect\" signal\r\n  useEffect(() => {\r\n    let isInitialCall = true;\r\n    const unsubscribeIncorrect = listenToIncorrectRow(roomId, (data) => {\r\n      if (isInitialCall) {\r\n        isInitialCall = false;\r\n        return; // Skip the initial snapshot\r\n      }\r\n\r\n      const audio = sounds['wrong_2'];\r\n      if (audio) {\r\n        audio.play();\r\n      }\r\n      let rowIndex = -1;\r\n      let colIndex = -1;\r\n      for (let row = 0; row < grid.length; row++) {\r\n        for (let col = 0; col < grid[row].length; col++) {\r\n          if (grid[row][col] === `number${data.selected_row_number}`) {\r\n            rowIndex = row;\r\n            colIndex = col;\r\n            break;\r\n          }\r\n        }\r\n        if (rowIndex !== -1) break;\r\n      }\r\n\r\n      if (rowIndex === -1 || colIndex === -1) {\r\n        console.warn(`Number cell number${data.selected_row_number} not found`);\r\n        return;\r\n      }\r\n\r\n      revealCellsForPlayer(rowIndex, colIndex, \"incorrect\", data.selected_row_number, [], data.is_row, data.word_length);\r\n    });\r\n\r\n    return () => {\r\n      unsubscribeIncorrect();\r\n    };\r\n  }, [roomId, grid]);\r\n\r\n  // Listen for \"correct\" signal\r\n  useEffect(() => {\r\n    let isInitialCall = true;\r\n    const unsubscribeCorrect = listenToCorrectRow(\r\n      roomId,\r\n      (data) => {\r\n        console.log(\"isInitialCall\", isInitialCall);\r\n\r\n        if (isInitialCall) {\r\n          isInitialCall = false;\r\n          return; // Skip the initial snapshot\r\n        }\r\n\r\n        const audio = sounds['correct_2'];\r\n        if (audio) {\r\n          audio.play();\r\n        }\r\n\r\n        console.log(\"isInitialCall after\", isInitialCall);\r\n        let rowIndex = -1;\r\n        let colIndex = -1;\r\n        console.log(\"grid\", grid);\r\n\r\n        for (let row = 0; row < grid.length; row++) {\r\n          for (let col = 0; col < grid[row].length; col++) {\r\n            if (grid[row][col] === `number${data.selected_row_number}`) {\r\n              rowIndex = row;\r\n              colIndex = col;\r\n              break;\r\n            }\r\n          }\r\n          if (rowIndex !== -1) break;\r\n        }\r\n\r\n        if (rowIndex === -1 || colIndex === -1) {\r\n          console.warn(`Number cell number${data.selected_row_number} not found`);\r\n          return;\r\n        }\r\n\r\n        revealCellsForPlayer(rowIndex, colIndex, \"correct\", data.selected_row_number, data.marked_character_index, data.is_row, undefined, data.correct_answer);\r\n      }\r\n    );\r\n\r\n    return () => {\r\n      unsubscribeCorrect();\r\n    };\r\n  }, [roomId, grid]);\r\n\r\n\r\n  // Reveal cells in a row or column\r\n\r\n\r\n  // Handle number click to show menu\r\n  const handleNumberClick = (rowIndex: number, colIndex: number) => {\r\n    if (!isHost) return;\r\n    setMenu({\r\n      visible: true,\r\n      rowIndex,\r\n      colIndex,\r\n    });\r\n  };\r\n\r\n  // Handle menu actions\r\n  const handleMenuAction = (\r\n    action: \"open\" | \"correct\" | \"incorrect\",\r\n    rowIndex: number,\r\n    colIndex: number,\r\n    hintWordNumber: string\r\n  ) => {\r\n    revealCells(rowIndex, colIndex, action, hintWordNumber);\r\n    setMenu({ visible: false });\r\n  };\r\n\r\n  // Handle cell click to reveal\r\n  const handleCellClick = (rowIndex: number, colIndex: number) => {\r\n    if (!isHost) return;\r\n    revealCells(rowIndex, colIndex, \"open\");\r\n  };\r\n\r\n  const handleOpenObstacle = async () => {\r\n    if (!isHost || !hintWords || !hintWordArray || !numberPositions) return;\r\n    console.log(\"hintWords in obstacle\", hintWords);\r\n\r\n    for (var word of hintWords) {\r\n      revealCells(word.x, word.y, \"all\", word.index.toString())\r\n    }\r\n    // for (let row = 0; row < grid.length; row++) {\r\n    //   for (let col = 0; col < grid[row].length; col++) {\r\n    //     if (Number.isFinite(Number(grid[row][col]))) {\r\n    //       revealCells(row, col, \"correct\", grid[row][col])\r\n    //     }\r\n    //   }\r\n    // }\r\n\r\n    const playerPlacementArray = hintWords.map((word) => (\r\n      {\r\n        \"row_index\": word.x,\r\n        \"col_index\": word.y,\r\n        \"index\": word.index,\r\n        \"is_row\": word.dir === 1 ? true : false,\r\n        \"word\": word.string.slice(2, word.string.length - 1)\r\n      }\r\n    ))\r\n    if (obstacleWord) {\r\n\r\n      await openObstacle(roomId, obstacleWord, playerPlacementArray)\r\n    }\r\n  }\r\n\r\n  // Close menu on outside click\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\r\n        setMenu({ visible: false });\r\n      }\r\n    };\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => document.removeEventListener(\"mousedown\", handleClickOutside);\r\n  }, []);\r\n\r\n\r\n  return (\r\n    <div className=\"flex flex-col items-center bg-slate-800/80 backdrop-blur-sm rounded-xl border border-blue-400/30 shadow-2xl p-6 mb-4 relative\">\r\n      <div className=\"text-white text-xl font-semibold text-center mb-4 max-w-[90%]\">\r\n        {typeof currentQuestion?.question === \"string\"\r\n          ? currentQuestion.question\r\n          : \"\"}\r\n      </div>\r\n      <div className=\"grid  [grid-template-columns:repeat(var(--cols),32px)] [grid-auto-rows:max-content]  gap-1 max-h-[750px] overflow-y-auto overflow-visible\"\r\n        style={{ '--cols': grid[0]?.length || 1 } as React.CSSProperties}\r\n      >\r\n\r\n        {(!grid || !Array.isArray(grid) || !grid.every(row => Array.isArray(row))) ?\r\n          <div className=\"text-white\">Invalid grid data</div>\r\n          :\r\n          grid.map((row, rowIndex) => (\r\n            <React.Fragment key={rowIndex}>\r\n              {row.map((cell, colIndex) => {\r\n\r\n                const cellKey = `${rowIndex}-${colIndex}`;\r\n                const cellStyle = cellStyles[cellKey] || {\r\n                  background: cell === \"\" || cell === \" \" ? \"transparent\" : \"bg-white\",\r\n                  textColor: cell.includes(\"number\") ? \"text-blue-400\" : \"text-transparent\",\r\n                };\r\n\r\n                const showMenu =\r\n                  menu.visible &&\r\n                  menu.rowIndex === rowIndex &&\r\n                  menu.colIndex === colIndex &&\r\n                  cell.includes(\"number\");\r\n\r\n                return (\r\n                  <div className=\"relative w-8 h-8 flex items-center justify-center overflow-visible\" key={colIndex}>\r\n                    <div\r\n                      className={`w-8 h-8 flex items-center justify-center text-lg font-semibold select-none rounded-lg overflow-visible   \r\n                  ${cell.includes(\"number\") ? \"text-blue-400 border-none\" : \"\"}\r\n                  ${cell.includes(\"number\") ? \"\" : cellStyle.background}\r\n                  ${cell.includes(\"number\") ? \"text-blue-400\" : cellStyle.textColor}\r\n                  ${obstacleWord?.includes(cell) &&\r\n                          cellStyle.textColor === \"text-black\" &&\r\n                          !cell.includes(\"number\") &&\r\n                          isNaN(Number(cell))\r\n                          ? \"font-bold text-red-400\"\r\n                          : \"\"}\r\n                `}\r\n                      onClick={() => {\r\n                        if (isHost) {\r\n                          if (cell.includes(\"number\")) {\r\n                            handleNumberClick(rowIndex, colIndex);\r\n                          } else {\r\n                            handleCellClick(rowIndex, colIndex);\r\n                          }\r\n                        }\r\n                      }}\r\n                      style={{\r\n                        cursor:\r\n                          isHost &&\r\n                            (cell.includes(\"number\") ||\r\n                              hintWords.some((word) => word.y === rowIndex || word.x === colIndex))\r\n                            ? \"pointer\"\r\n                            : \"default\",\r\n                      }}\r\n                    >\r\n\r\n                      {typeof cell === \"string\" || typeof cell === \"number\"\r\n                        ? (cell.includes(\"number\") ? cell.replace(\"number\", \"\") : cell)\r\n                        : \"\"}\r\n                    </div>\r\n\r\n                    {showMenu && (\r\n\r\n                      <div\r\n                        ref={menuRef}\r\n                        className=\"absolute left-12 top-1/2 transform -translate-y-1/2 flex space-x-2 bg-slate-900 border border-blue-400/50 rounded shadow-lg p-1 z-10\"\r\n                      >\r\n                        <button\r\n                          className=\"px-2 py-1 text-sm bg-blue-500 text-white rounded hover:bg-blue-600\"\r\n                          onClick={() =>\r\n                            handleMenuAction(\"open\", rowIndex, colIndex, cell.replace(\"number\", \"\"))\r\n                          }\r\n                        >\r\n                          SELECT\r\n                        </button>\r\n                        <button\r\n                          className=\"px-2 py-1 text-sm bg-green-500 text-white rounded hover:bg-green-600\"\r\n                          onClick={() =>\r\n                            handleMenuAction(\"correct\", rowIndex, colIndex, cell.replace(\"number\", \"\"))\r\n                          }\r\n                        >\r\n                          Correct\r\n                        </button>\r\n                        <button\r\n                          className=\"px-2 py-1 text-sm bg-red-500 text-white rounded hover:bg-red-600\"\r\n                          onClick={() =>\r\n                            handleMenuAction(\"incorrect\", rowIndex, colIndex, cell.replace(\"number\", \"\"))\r\n                          }\r\n                        >\r\n                          Incorrect\r\n                        </button>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              })}\r\n            </React.Fragment>\r\n          ))}\r\n      </div>\r\n      {\r\n        !isSpectator && (\r\n          <PlayerAnswerInput\r\n            isHost={isHost}\r\n            question={currentQuestion}\r\n          />\r\n        )\r\n      }\r\n\r\n      {\r\n        isHost && (\r\n          <div className=\"flex gap-2 mt-4 w-full\">\r\n            <button\r\n              onClick={() => {\r\n                alert('Mở cnv!')\r\n                handleOpenObstacle()\r\n              }}\r\n              className=\"bg-indigo-600 hover:bg-indigo-700 text-white p-2 flex-1 rounded-md whitespace-nowrap\"\r\n            >\r\n              Mở CNV\r\n            </button>\r\n            <button\r\n              onClick={() => {\r\n                handleSuffleGrid()\r\n              }}\r\n              className=\"bg-indigo-600 hover:bg-indigo-700 text-white p-2 flex-1 rounded-md whitespace-nowrap\"\r\n            >\r\n              Xáo trộn hàng ngang\r\n            </button>\r\n          </div>\r\n        )\r\n      }\r\n\r\n      {showModal && buzzedPlayer && (\r\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50\">\r\n          <div className=\"bg-white rounded-lg p-6 w-80 shadow-lg\">\r\n            <h2 className=\"text-lg font-semibold text-gray-800 mb-4 text-center\">\r\n              {`${buzzedPlayer} đã nhấn chuông trả lời`}\r\n            </h2>\r\n            <div className=\"flex justify-center\">\r\n              <button\r\n                onClick={handleCloseModal}\r\n                className=\"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-400\"\r\n              >\r\n                Đóng\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n};\r\n\r\nexport default QuestionBoxRound2;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}